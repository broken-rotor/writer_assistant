<h2 mat-dialog-title>Expand Character Details with AI</h2>

<mat-dialog-content>
  <div class="expansion-dialog-content">
    <!-- Section Info -->
    <div class="section-info">
      <strong>Section:</strong> {{ sectionLabel }}
    </div>

    <!-- Current Content -->
    <div class="current-content">
      <h3>Current Content:</h3>
      <div class="content-box">
        <pre *ngIf="currentContent">{{ currentContent }}</pre>
        <p *ngIf="!currentContent" class="empty-content">No content yet</p>
      </div>
    </div>

    <!-- Expansion Request Form -->
    <div class="expansion-request" *ngIf="!showPreview">
      <h3>Your Expansion Request:</h3>
      <form [formGroup]="expansionForm">
        <mat-form-field appearance="outline" class="full-width">
          <mat-label>What would you like to expand?</mat-label>
          <textarea matInput
                    formControlName="expansionPrompt"
                    rows="4"
                    placeholder="E.g., Expand on how Sarah's curiosity manifests in her investigative work and personal life"></textarea>
          <mat-error *ngIf="expansionForm.get('expansionPrompt')?.hasError('required')">
            Please describe what you'd like to expand
          </mat-error>
          <mat-error *ngIf="expansionForm.get('expansionPrompt')?.hasError('minlength')">
            Please provide more detail (at least 10 characters)
          </mat-error>
        </mat-form-field>
      </form>

      <div class="action-buttons">
        <button mat-raised-button
                color="primary"
                (click)="onGenerateExpansion()"
                [disabled]="!expansionForm.valid || isGenerating">
          <mat-icon *ngIf="!isGenerating">auto_awesome</mat-icon>
          <mat-spinner *ngIf="isGenerating" diameter="20"></mat-spinner>
          {{ isGenerating ? 'Generating...' : 'Generate Expansion' }}
        </button>

        <button mat-button (click)="onCancel()">Cancel</button>
      </div>
    </div>

    <!-- Generated Content Preview -->
    <div class="expansion-preview" *ngIf="showPreview">
      <h3>AI-Generated Expansion (Preview):</h3>
      <div class="content-box preview">
        <pre>{{ generatedContent }}</pre>
      </div>

      <div class="action-buttons">
        <button mat-raised-button color="primary" (click)="onAccept()">
          <mat-icon>check</mat-icon> Accept
        </button>

        <button mat-raised-button (click)="onEditBeforeAccepting()">
          <mat-icon>edit</mat-icon> Edit Before Accepting
        </button>

        <button mat-button (click)="onRegenerate()">
          <mat-icon>refresh</mat-icon> Regenerate
        </button>

        <button mat-button (click)="onRequestAlternative()">
          Request Alternative
        </button>

        <button mat-button (click)="onCancel()">
          Cancel
        </button>
      </div>
    </div>
  </div>
</mat-dialog-content>
