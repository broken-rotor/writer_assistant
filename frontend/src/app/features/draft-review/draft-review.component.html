<div class="draft-review-container" *ngIf="story">
  <!-- Story Header -->
  <mat-card class="story-header-card">
    <mat-card-header>
      <mat-card-title>{{ story.title }}</mat-card-title>
      <mat-card-subtitle>
        {{ story.genre }} • {{ story.length | titlecase }} • Draft Review
      </mat-card-subtitle>
    </mat-card-header>
  </mat-card>

  <!-- Current Draft Display -->
  <mat-card class="draft-content-card" *ngIf="story.currentDraft">
    <mat-card-header>
      <mat-card-title>Generated Draft</mat-card-title>
      <mat-card-subtitle>Review and provide feedback or approve to continue</mat-card-subtitle>
    </mat-card-header>

    <mat-card-content>
      <!-- Draft Title -->
      <div class="draft-section">
        <h3>Title</h3>
        <p class="draft-title">{{ story.currentDraft.title }}</p>
      </div>

      <!-- Draft Outline -->
      <div class="draft-section">
        <h3>Story Outline</h3>
        <div class="outline-content">
          <p *ngFor="let point of story.currentDraft.outline" class="outline-point">
            • {{ point }}
          </p>
        </div>
      </div>

      <!-- Characters -->
      <div class="draft-section" *ngIf="story.currentDraft.characters && story.currentDraft.characters.length > 0">
        <h3>Characters</h3>
        <div class="characters-grid">
          <mat-card class="character-card" *ngFor="let character of story.currentDraft.characters">
            <mat-card-header>
              <mat-card-title>{{ character.name }}</mat-card-title>
            </mat-card-header>
            <mat-card-content>
              <p><strong>Personality:</strong> {{ character.personality }}</p>
              <p><strong>Background:</strong> {{ character.background }}</p>
              <p><strong>Role:</strong> {{ character.role }}</p>
            </mat-card-content>
          </mat-card>
        </div>
      </div>

      <!-- Themes -->
      <div class="draft-section" *ngIf="story.currentDraft.themes && story.currentDraft.themes.length > 0">
        <h3>Key Themes</h3>
        <mat-chip-list>
          <mat-chip *ngFor="let theme of story.currentDraft.themes">{{ theme }}</mat-chip>
        </mat-chip-list>
      </div>
    </mat-card-content>
  </mat-card>

  <!-- Revision Feedback Form -->
  <mat-card class="feedback-card">
    <mat-card-header>
      <mat-card-title>Provide Feedback</mat-card-title>
      <mat-card-subtitle>Request changes or approve the current draft</mat-card-subtitle>
    </mat-card-header>

    <mat-card-content>
      <form [formGroup]="feedbackForm" class="feedback-form">
        <!-- General Feedback -->
        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Your Feedback</mat-label>
          <textarea
            matInput
            formControlName="feedback"
            rows="4"
            placeholder="Describe what you'd like to change or improve...">
          </textarea>
          <mat-error *ngIf="feedbackForm.get('feedback')?.hasError('required')">
            Feedback is required for revision
          </mat-error>
          <mat-error *ngIf="feedbackForm.get('feedback')?.hasError('minlength')">
            Please provide more detailed feedback
          </mat-error>
        </mat-form-field>

        <!-- Specific Changes -->
        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Specific Areas to Focus On</mat-label>
          <mat-select formControlName="specificChanges" multiple>
            <mat-option *ngFor="let change of specificChangeOptions" [value]="change">
              {{ change }}
            </mat-option>
          </mat-select>
        </mat-form-field>
      </form>
    </mat-card-content>
  </mat-card>

  <!-- Action Buttons -->
  <div class="action-section">
    <div class="primary-actions">
      <button
        mat-raised-button
        color="primary"
        [disabled]="!canApprove"
        (click)="onApprove()"
        class="approve-button">
        <mat-icon>check_circle</mat-icon>
        Approve Draft
      </button>

      <button
        mat-raised-button
        color="accent"
        [disabled]="!canRevise || feedbackForm.invalid"
        (click)="onRequestRevision()"
        class="revise-button">
        <mat-icon *ngIf="isRevising">autorenew</mat-icon>
        <mat-icon *ngIf="!isRevising">edit</mat-icon>
        <span *ngIf="!isRevising">Request Revision</span>
        <span *ngIf="isRevising">Revising...</span>
      </button>
    </div>

    <div class="secondary-actions">
      <button
        mat-button
        (click)="onStartOver()"
        class="start-over-button">
        <mat-icon>refresh</mat-icon>
        Start Over
      </button>

      <button
        mat-button
        *ngIf="hasRevisionHistory"
        (click)="onViewRevisionHistory()">
        <mat-icon>history</mat-icon>
        View History
      </button>
    </div>
  </div>

  <!-- Progress Indicator -->
  <div class="progress-section">
    <h4>Story Development Progress</h4>
    <mat-progress-bar mode="determinate" [value]="25"></mat-progress-bar>
    <p class="progress-text">Phase 1 of 4: Draft Development</p>
  </div>
</div>

<!-- Loading State -->
<div class="loading-container" *ngIf="!story">
  <mat-spinner></mat-spinner>
  <p>Loading story...</p>
</div>