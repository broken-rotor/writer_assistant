<!-- plot-outline-tab.component.html -->
<div class="plot-outline-tab">
  <!-- Main Content Area -->
  <div class="main-content" [class.with-chat]="showChat">
    
    <!-- Left Panel: Outline Editor -->
    <div class="outline-panel">
      <h3>Overall Story Plot Outline</h3>
      <textarea 
        [(ngModel)]="story.plotOutline.content"
        (ngModelChange)="onOutlineChange()"
        placeholder="Act I: Setup&#10;- Character introduction&#10;- Inciting incident&#10;&#10;Act II: Rising Action&#10;- Conflict development&#10;- Complications&#10;&#10;Act III: Resolution&#10;- Climax&#10;- Resolution"
        rows="20"
        class="outline-editor"
        [disabled]="disabled">
      </textarea>
      
      <div class="outline-actions">
        <button 
          class="secondary-button" 
          (click)="aiExpandOutline()" 
          [disabled]="isGeneratingAI || disabled">
          <span *ngIf="!isGeneratingAI">ğŸ¤– AI Expand</span>
          <span *ngIf="isGeneratingAI">â³ Generating...</span>
        </button>
        
        <button 
          class="secondary-button" 
          (click)="researchOutline()" 
          [disabled]="isResearching || disabled"
          title="Research similar content from story archive">
          <span *ngIf="!isResearching">ğŸ“š Research</span>
          <span *ngIf="isResearching">â³ Researching...</span>
        </button>
        
        <button class="secondary-button" (click)="saveOutline()" [disabled]="disabled">ğŸ’¾ Save</button>
        <button class="secondary-button" (click)="resetOutline()" [disabled]="disabled">ğŸ”„ Reset</button>
      </div>
      
      <div class="outline-status">
        Status: <span class="status-badge status-{{story.plotOutline.status}}">
          {{ getStatusDisplay() }}
        </span>
      </div>
    </div>

    <!-- Right Panel: AI Chat Assistant -->
    <div class="chat-panel" *ngIf="showChat">
      <h3>ğŸ’¬ AI Chat Assistant</h3>
      
      <div class="chat-messages" #chatMessages>
        <div *ngFor="let message of story.plotOutline.chatHistory" 
             class="chat-message"
             [class.user-message]="message.type === 'user'"
             [class.ai-message]="message.type === 'assistant'">
          <div class="message-content">{{ message.content }}</div>
          <div class="message-timestamp">{{ message.timestamp | date:'short' }}</div>
        </div>
        
        <div *ngIf="isChatGenerating" class="chat-message ai-message generating">
          <div class="message-content">
            <span class="typing-indicator">AI is thinking...</span>
          </div>
        </div>
        
        <div *ngIf="story.plotOutline.chatHistory.length === 0 && !isChatGenerating" class="empty-chat">
          Start a conversation about your plot outline...
        </div>
      </div>
      
      <div class="chat-error" *ngIf="chatError">
        <span class="error-message">{{ chatError }}</span>
        <button class="retry-button" (click)="chatError = null">âœ•</button>
      </div>
      
      <div class="chat-input-area">
        <textarea 
          [(ngModel)]="chatInput"
          placeholder="Type your message..."
          rows="3"
          class="chat-input"
          [disabled]="disabled || isChatGenerating"
          (keydown.ctrl.enter)="sendChatMessage()"
          (keydown.meta.enter)="sendChatMessage()">
        </textarea>
        <div class="chat-actions">
          <button 
            class="primary-button" 
            (click)="sendChatMessage()" 
            [disabled]="!chatInput.trim() || disabled || isChatGenerating">
            <span *ngIf="!isChatGenerating">Send</span>
            <span *ngIf="isChatGenerating">â³ Sending...</span>
          </button>
          <button 
            class="secondary-button" 
            (click)="clearChat()" 
            [disabled]="disabled || story.plotOutline.chatHistory.length === 0">
            Clear Chat
          </button>
        </div>
        <div class="chat-hint">
          <small>Tip: Press Ctrl+Enter (Cmd+Enter on Mac) to send</small>
        </div>
      </div>
      
      <div class="quick-actions">
        <h4>Quick Actions</h4>
        <div class="quick-action-buttons">
          <button class="quick-action-btn" (click)="suggestPlotStructure()" [disabled]="disabled || isChatGenerating">
            ğŸ“‹ Suggest Structure
          </button>
          <button class="quick-action-btn" (click)="identifyPlotHoles()" [disabled]="disabled || isChatGenerating">
            ğŸ” Find Plot Holes
          </button>
          <button class="quick-action-btn" (click)="generateCharacterArcs()" [disabled]="disabled || isChatGenerating">
            ğŸ‘¥ Character Arcs
          </button>
          <button class="quick-action-btn" (click)="checkPacing()" [disabled]="disabled || isChatGenerating">
            â±ï¸ Check Pacing
          </button>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Placeholder for Rater Feedback Section -->
  <div class="rater-feedback-section">
    <h3>ğŸ“ Rater Feedback Section</h3>
    <p><em>Rater feedback functionality will be implemented in the next task.</em></p>
  </div>
</div>
