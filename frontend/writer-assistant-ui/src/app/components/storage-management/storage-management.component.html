<div class="storage-management">
  <h2>Storage Management</h2>

  <!-- Storage Overview -->
  <div class="storage-overview">
    <h3>Storage Usage</h3>
    <div class="storage-meter">
      <div class="storage-bar" [class]="getStoragePercentageClass()">
        <div class="storage-fill" [style.width.%]="storageQuota.percentage"></div>
      </div>
      <div class="storage-info">
        <span>{{ getUsedStorageInMB() }} MB used of {{ getTotalStorageInMB() }} MB</span>
        <span class="storage-percentage">{{ storageQuota.percentage.toFixed(1) }}%</span>
      </div>
    </div>
  </div>

  <!-- Storage Breakdown -->
  <div class="storage-breakdown">
    <h3>Storage Breakdown</h3>
    <div class="stats-grid">
      <div class="stat-item" *ngFor="let stat of storageStats | keyvalue">
        <div class="stat-label">{{ stat.key | titlecase }}</div>
        <div class="stat-value">{{ formatBytes(stat.value) }}</div>
      </div>
    </div>
  </div>

  <!-- Stories List -->
  <div class="stories-list">
    <h3>Your Stories ({{ storiesIndex.length }})</h3>
    <div class="list-actions">
      <button class="btn btn-primary" (click)="openExportDialog()">
        Export All Stories
      </button>
      <button class="btn btn-warning" (click)="openCleanupDialog()">
        Cleanup Old Stories
      </button>
    </div>

    <div class="stories-table" *ngIf="storiesIndex.length > 0">
      <div class="table-header">
        <div class="col-title">Title</div>
        <div class="col-genre">Genre</div>
        <div class="col-size">Size</div>
        <div class="col-modified">Last Modified</div>
        <div class="col-actions">Actions</div>
      </div>
      <div class="table-row" *ngFor="let story of storiesIndex">
        <div class="col-title">{{ story.title }}</div>
        <div class="col-genre">{{ story.genre }}</div>
        <div class="col-size">{{ getStorySizeInKB(story) }} KB</div>
        <div class="col-modified">{{ getFormattedDate(story.lastModified) }}</div>
        <div class="col-actions">
          <button class="btn btn-sm btn-danger" (click)="deleteStory(story.id)">
            Delete
          </button>
        </div>
      </div>
    </div>

    <div class="empty-state" *ngIf="storiesIndex.length === 0">
      <p>No stories found. Create your first story to get started!</p>
    </div>
  </div>

  <!-- Import Section -->
  <div class="import-section">
    <h3>Import Stories</h3>
    <div class="import-controls">
      <input type="file" accept=".json" (change)="onFileSelected($event)" #fileInput>
      <button class="btn btn-primary" (click)="importStories()" [disabled]="!importFile || isImporting">
        {{ isImporting ? 'Importing...' : 'Import Stories' }}
      </button>
    </div>
  </div>

  <!-- Import Result -->
  <div class="import-result" *ngIf="importResult">
    <div class="result-summary">
      <h4>Import Results</h4>
      <p>Successfully imported {{ importResult.success }} stories.</p>
      <div class="errors" *ngIf="importResult.errors.length > 0">
        <h5>Errors:</h5>
        <ul>
          <li *ngFor="let error of importResult.errors">{{ error }}</li>
        </ul>
      </div>
      <button class="btn btn-secondary" (click)="closeImportResult()">Close</button>
    </div>
  </div>

  <!-- Quick Actions -->
  <div class="quick-actions">
    <h3>Quick Actions</h3>
    <div class="actions-grid">
      <button class="btn btn-info" (click)="createBackup()">
        Create Backup
      </button>
      <button class="btn btn-secondary" (click)="optimizeStorage()">
        Optimize Storage
      </button>
    </div>
  </div>

  <!-- Cleanup Dialog -->
  <div class="modal" *ngIf="showCleanupDialog">
    <div class="modal-content">
      <h3>Cleanup Old Stories</h3>
      <p>This will permanently delete stories that haven't been modified in the specified number of days.</p>
      <div class="form-group">
        <label for="maxAge">Delete stories older than:</label>
        <input type="number" id="maxAge" [(ngModel)]="cleanupMaxAge" min="1" max="365">
        <span>days</span>
      </div>
      <div class="modal-actions">
        <button class="btn btn-danger" (click)="performCleanup()">Delete Old Stories</button>
        <button class="btn btn-secondary" (click)="closeCleanupDialog()">Cancel</button>
      </div>
    </div>
  </div>

  <!-- Export Dialog -->
  <div class="modal" *ngIf="showExportDialog">
    <div class="modal-content">
      <h3>Export All Stories</h3>
      <p>This will download a JSON file containing all your stories, including content, memory, and configuration data.</p>
      <div class="export-info">
        <p><strong>Stories to export:</strong> {{ storiesIndex.length }}</p>
        <p><strong>Estimated file size:</strong> {{ formatBytes(storageQuota.used) }}</p>
      </div>
      <div class="modal-actions">
        <button class="btn btn-primary" (click)="exportAllStories()" [disabled]="isExporting">
          {{ isExporting ? 'Exporting...' : 'Download Export' }}
        </button>
        <button class="btn btn-secondary" (click)="closeExportDialog()">Cancel</button>
      </div>
    </div>
  </div>

  <!-- Modal Backdrop -->
  <div class="modal-backdrop" *ngIf="showCleanupDialog || showExportDialog" (click)="closeCleanupDialog(); closeExportDialog()"></div>
</div>